---
title: "create_EML"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Crear EML para el conjunto de datos 

```{r}
library("emld")
library("EML")
```

## Estructura del EML

- eml
  - dataset
    - creator
    - title
    - publisher
    - pubDate
    - keywords
    - abstract 
    - intellectualRights
    - contact
    - methods
    - coverage
      - geographicCoverage
      - temporalCoverage
      - taxonomicCoverage
    - dataTable
      - entityName
      - entityDescription
      - physical
      - attributeList


## 1. Esquema de organizaci√≥n del datapkg (dpkg)

```{r}
library("EMLassemblyline")

# Create datapkg directory
template_directories(path = here::here("/md_EML"), dir.name = "dpkg_adaptamed_c5_1")

```

## 2. Crear templates de metadatos
### 2a Core medatados 

```{r}
template_core_metadata(
  path = here::here("md_EML/dpkg_adaptamed_c5_1/metadata_templates/"),
  license = 'CC0')
```

### 2b table attributes
```{r}
# copy file 
file.copy(from = here::here("data/revision_siembras_all.csv"), 
          to = here::here("md_EML/dpkg_adaptamed_c5_1/data_objects/"))
# rename 
file.rename(
  from = here::here("md_EML/dpkg_adaptamed_c5_1/data_objects/revision_siembras_all.csv"),
  to = here::here("md_EML/dpkg_adaptamed_c5_1/data_objects/juniperus_germination.csv"))


template_table_attributes(
  path = here::here("md_EML/dpkg_adaptamed_c5_1/metadata_templates/"),
  data.path = here::here("md_EML/dpkg_adaptamed_c5_1/data_objects/"),
  data.table = "juniperus_germination.csv"
)

```

### 2c geographic coverage
```{r}

library("sf")
geo <- st_read(here::here("/data/spatial/siembras_a5.shp"))
geo %>% dplyr::select(-OBJECTID) %>% 
  st_transform(crs=4326) %>% 
  st_write(here::here("/data/spatial/juniperus_sowing_spatial.csv"), 
           layer_options = "GEOMETRY=AS_XY")


# copy file 
file.copy(from = here::here("data/spatial/juniperus_sowing_spatial.csv"), 
          to = here::here("md_EML/dpkg_adaptamed_c5_1/data_objects/"), overwrite = TRUE)
```

```{r}
template_geographic_coverage(
  path = here::here("md_EML/dpkg_adaptamed_c5_1/metadata_templates/"),
  data.path = here::here("md_EML/dpkg_adaptamed_c5_1/data_objects/"),
  data.table = "juniperus_sowing_spatial.csv",
  site.col = 'cod_sowing',
  lat.col = 'Y',
  lon.col = 'X'
)
```


### 2d taxonomical coverage

```{r}
template_taxonomic_coverage(
  path = here::here("md_EML/dpkg_adaptamed_c5_1/metadata_templates/"),
  data.path = here::here("md_EML/dpkg_adaptamed_c5_1/data_objects/"),
  taxa.table = "juniperus_taxa.csv",
  taxa.col = 'taxa',
  taxa.authority = c(3,11),
  taxa.name.type = 'scientific'
)
```


```{r}
make_eml(
  path = here::here("md_EML/dpkg_adaptamed_c5_1/metadata_templates/"),
  data.path = here::here("md_EML/dpkg_adaptamed_c5_1/data_objects/"),
  eml.path = here::here("md_EML/dpkg_adaptamed_c5_1/eml/"),
  dataset.title = 'Siembras A5',
  temporal.coverage = c('2014-05-01', '2015-10-31'),
  maintenance.description = 'ongoing',
  data.table = c('juniperus_germination.csv',
                 'juniperus_sowing_spatial.csv', 
                 'juniperus_taxa.csv'),
  data.table.name = c('Germination counts', 'Spatial info', 'Taxonomic info'),
  data.table.description = c('los conteos', 'la info espacial', 'la info taxo')
)
```

